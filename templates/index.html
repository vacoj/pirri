<!doctype html>
<html ng-app="pirriweb" ng-cloak="true">
    <head>
        <title>Pirri</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.1/angular-material.min.css" />
        <link rel="stylesheet" href="/static/style.css">
        <script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
        <link href="/static/easycal/easycal.css" rel="stylesheet">
        <link rel="icon" href="static/icon.png">
        <script src="/static/easycal/easycal.js"></script>
    </head>
    <body>
        <div ng-controller="PirriControl as pc">
            <div id="station-schedules">
                <section>
                    <div id="nav">
                        <h1 id="schedtitle"><img height="100" width="150" src="static/icon_text.png"></h1>
                        <div id="searchTextDiv" class="col-sm-3 pull-right">
                            <p><input type="text" id="searchText" ng-model="searchText" placeholder="Search stations..." class="form-control col-sm-2" ng-change="pc.filterForKeys(searchText)"></p>
                        </div>
                        <div id="navicons">
                            <div>
                                <a href><span class="glyphicon glyphicon-refresh" ng-click="pc.refresh()"></span></a>
                                <span> - - - </span>
                                <a href><span class="glyphicon glyphicon-home" ng-click="currentPage = 'home'"></span></a>
                                <span > - </span>
                                <a href><span class="glyphicon glyphicon-calendar" ng-click="currentPage = 'mycal'"></span></a>
                                
                                <span > - </span>
                                <a href><span class="glyphicon glyphicon-list" ng-click="currentPage = 'calendar'"></span></a>
                                
                                <span > - </span>
                                <a href><span class="glyphicon glyphicon-time" ng-click="currentPage = 'history'"></span></a>
                                <span > - </span>
                                <a href><span class="glyphicon glyphicon-stats" ng-click="currentPage = 'stats'"></span></a>
                                <span id="navTitle"> - - - {[navTitle]}</span>
                            </div>
                        </div>
                    </div>
                    <!-- START STATIONS LIST -->
                    <div ng-show="currentPage == 'home'" id="navpane">
                        <div class="tbl-header">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <thead>
                                    <th class="col-md-1">Station</th>
                                    <th class="col-md-3">Last Run</th>
                                    <th class="col-md-3">Next Run</th>
                                    <th class="col-md-1">GPIO</th>
                                    <th class="col-md-3">Notes</th>
                                    <th class="col-md-1">Controls</th>
                                </thead>
                            </table>
                        </div>
                        <div class="tbl-content">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <tbody>
                                    <tr ng-repeat="station in stations" ng-hide="showSearchResults">
                                        <td class="col-md-1"><a > {[station.sid]} <span ng-click="pc.setEditingStationInfo(station.sid, station.gpio_pin, station.notes); pc.setPage('editstation')" class="glyphicon glyphicon-cog"></span></a></td>
                                        <td class="col-md-3">{[pc.prettyTime(lastStationRunHash[station.sid])]}</td>
                                        <td class="col-md-3">{[pc.prettyTime(nextStationRunHash[station.sid].next_datetime)]} for {[nextStationRunHash[station.sid].duration / 60]} min</td>
                                        <td class="col-md-1">{[station.gpio_pin]}</td>
                                        <td class="col-md-3">
                                            <span ng-hide="stationModel.sid == station.sid">{[station.notes]}</span>
                                            <div class="form-group" ng-show="stationModel.id == station.id">
                                                <input class="form-control" ng-show="stationModel.sid == station.sid" type="text" ng-model="stationModel.notes">
                                            </div>
                                            <div class="dropdown" ng-show="singleRunModel.sid == station.sid">
                                                <button ng-hide="singleRunModel.duration != undefined" class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">0 min</button>
                                                <button ng-show="singleRunModel.duration != undefined" class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">{[singleRunModel.duration]} min</button>
                                                <ul class="dropdown-menu">
                                                    <li ng-repeat="interval in durationIntervals" ng-click="singleRunModel.duration = interval * 60; pc.submitSingleRun()"><a >{[interval]} min</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                        <td class="col-md-1">
                                            <a ><span ng-hide="stationModel.sid == station.sid" ng-click="pc.setEditingStationInfo(station)" class="glyphicon glyphicon-pencil"></span></a>
                                            <a href><span ng-show="stationModel.sid == station.sid" class="glyphicon glyphicon-floppy-disk" ng-click="pc.submitEditStation();"></span></a>
                                            <a ><span class="glyphicon glyphicon-time"></span></a>
                                            <a ><span class="glyphicon glyphicon-stats"></span></a>
                                            <a ><span ng-hide="singleRunModel.sid == station.sid"" ng-click="singleRunModel.sid = station.sid; singleRunModel.sid = station.sid;" class="glyphicon glyphicon-play"></span></a>
                                            <a ><span ng-show="singleRunModel.sid == station.sid"" ng-click="singleRunModel.sid = undefined; singleRunModel.duration = undefined;" class="glyphicon glyphicon-stop"></span></a>
                                        </td>
                                    </tr>
                                    <tr ng-repeat="station in searchResults" ng-show="showSearchResults">
                                        <td><a > {[station.sid]} <span class="glyphicon glyphicon-cog"></span></a></td>
                                        <td>???????</td>
                                        <td>???????</td>
                                        <td>{[station.gpio_pin]}</td>
                                        <td>
                                            {[station.notes]}
                                        </td>
                                        <td><a ><span class="glyphicon glyphicon-time"></span></a></td>
                                        <td><a ><span class="glyphicon glyphicon-stats"></span></a></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="botnav">
                            <a href><span lass="glyphicon glyphicon-plus pull-right" ng-click="pc.setPage('add')"></span></a>
                        </div>
                    </div>
                    <!-- END STATIONS LIST -->
                    <!-- START TESTING CAL -->
                    <div id="navpane" ng-show="currentPage == 'mycal'" class="mycal"></div>
                    <script>
                        $('.mycal').easycal({

                            minTime : '00:00:00',
                            maxTime : '23:59:59',
                            slotDuration : 60,
                            startDate : '2016-10-06', 
                            events : [
                                {
                                    id: 'E01',
                                    title: 'Fake test',
                                    start: '2016-10-16 10:30:00',
                                    end: '2016-10-16 11:00:00',
                                    backgroundColor: '#000',
                                    textColor: '#FFF'
                                }
                            ]
                        });

                            $('.mycal').easycal({
                                columnDateFormat : 'dddd, DD MMM',
                                timeFormat : 'HH:mm',
                                minTime : '00:00:00',
                                maxTime : '23:59:59',
                                slotDuration : 60, //in mins
                                dayClick : null,
                                eventClick : null,
                                events : [],
                                widgetHeaderClass : 'ec-day-header',
                                widgetSlotClass : 'ec-slot',
                                widgetTimeClass : 'ec-time'
                            });
                    </script>

                    <!-- END TESTING CAL -->
                    <!-- START STATS-->
                    <div ng-show="currentPage == 'stats'" id="navpane">
                        <div class="col-md-6">
                            <canvas id="chart1" height="200" class="chart chart-bar" chart-options="chartData1.options" chart-data="chartData1.data" chart-labels="chartData1.labels" chart-series="chartData1.series"></canvas>
                        </div>
                        <div class=col-md-6>
                            <canvas id="chart2" height="200" class="chart chart-line" chart-options="chartData2.options" chart-data="chartData2.data" chart-labels="chartData2.labels" chart-series="chartData2.series"></canvas>
                        </div>
                    </div>
                    <!-- END STATS -->
                    <!-- START EDIT SCHEDULE -->
                    <div ng-show="currentPage == 'calendar'" id="navpane">
                        <div class="tbl-header">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <thead>
                                    <th class="col-md-1">Station</th>
                                    <th class="col-md-2">Start Date</th>
                                    <th class="col-md-2">Start Time</th>
                                    <th class="col-md-1">Duration</th>
                                    <th class="col-md-5">Days</th>
                                    <th class="col-md-1">
                                        <a><span id="navicons" ng-click="pc.addScheduleButton()" class="glyphicon glyphicon-plus"></span></a>
                                    </th>
                                </thead>
                            </table>
                        </div>
                        <div class="tbl-content">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <tbody>
                                    <tr ng-repeat="sched in schedule">
                                        <td class="col-md-1">
                                            <span ng-show="scheduleModel.id != sched.id">{[sched.station]}</span>
                                            <div class="form-group">
                                                <input class="form-control" ng-show="scheduleModel.id == sched.id" type="number" ng-model="scheduleModel.station">
                                            </div>
                                        </td>
                                        <td class="col-md-2">
                                            <span ng-show="scheduleModel.id != sched.id">{[sched.startdate]}</span>
                                            <div class="form-group">
                                                <input class="form-control" ng-show="scheduleModel.id == sched.id" type="number" ng-model="scheduleModel.startdate">
                                            </div>
                                        </td>
                                        <td class="col-md-2">
                                            <span ng-show="scheduleModel.id != sched.id">{[sched.starttime]}</span>
                                            <div class="form-group">
                                                <input class="form-control" ng-show="scheduleModel.id == sched.id" type="number" ng-model="scheduleModel.starttime">
                                            </div>
                                        </td>
                                        <td class="col-md-1">
                                            <span ng-show="scheduleModel.id != sched.id">{[sched.duration / 60]} min</span>
                                            <div class="dropdown" ng-show="scheduleModel.id == sched.id">
                                                <button ng-show="scheduleModel.duration != undefined && scheduleModel.id == sched.id" class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">{[scheduleModel.duration / 60]} min</button>
                                                <ul class="dropdown-menu">
                                                    <li ng-repeat="interval in durationIntervals" ng-click="scheduleModel.duration = interval * 60;"><a >{[interval]} min</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                        <td class="col-md-5">
                                            <div class="checkbox">
                                                <label><span ng-show="sched.sunday && scheduleModel.id != sched.id " class="glyphicon glyphicon-check"></span></label>
                                                <label><span ng-show="!sched.sunday && scheduleModel.id != sched.id " class="glyphicon glyphicon-unchecked"></span></label>
                                                <label><input ng-show="scheduleModel.id == sched.id" type="checkbox" ng-model="scheduleModel.sunday">Sun </label>
                                                <label><span ng-show="sched.monday && scheduleModel.id != sched.id " class="glyphicon glyphicon-check"></span></label>
                                                <label><span ng-show="!sched.monday && scheduleModel.id != sched.id " class="glyphicon glyphicon-unchecked"></span></label>
                                                <label><input ng-show="scheduleModel.id == sched.id" type="checkbox" ng-model="scheduleModel.monday">Mon </label>
                                                <label><span ng-show="sched.tuesday && scheduleModel.id != sched.id " class="glyphicon glyphicon-check"></span></label>
                                                <label><span ng-show="!sched.tuesday && scheduleModel.id != sched.id " class="glyphicon glyphicon-unchecked"></span></label>
                                                <label><input ng-show="scheduleModel.id == sched.id" type="checkbox" ng-model="scheduleModel.tuesday">Tue </label>
                                                <label><span ng-show="sched.wednesday && scheduleModel.id != sched.id " class="glyphicon glyphicon-check"></span></label>
                                                <label><span ng-show="!sched.wednesday && scheduleModel.id != sched.id " class="glyphicon glyphicon-unchecked"></span></label>
                                                <label><input ng-show="scheduleModel.id == sched.id" type="checkbox" ng-model="scheduleModel.wednesday">Wed </label>
                                                <label><span ng-show="sched.thursday && scheduleModel.id != sched.id " class="glyphicon glyphicon-check"></span></label>
                                                <label><span ng-show="!sched.thursday && scheduleModel.id != sched.id " class="glyphicon glyphicon-unchecked"></span></label>
                                                <label><input ng-show="scheduleModel.id == sched.id" type="checkbox" ng-model="scheduleModel.thursday">Thu </label>
                                                <label><span ng-show="sched.friday && scheduleModel.id != sched.id " class="glyphicon glyphicon-check"></span></label>
                                                <label><span ng-show="!sched.friday && scheduleModel.id != sched.id " class="glyphicon glyphicon-unchecked"></span></label>
                                                <label><input ng-show="scheduleModel.id == sched.id" type="checkbox" ng-model="scheduleModel.friday">Fri </label>
                                                <label><span ng-show="sched.saturday && scheduleModel.id != sched.id " class="glyphicon glyphicon-check"></span></label>
                                                <label><span ng-show="!sched.saturday && scheduleModel.id != sched.id " class="glyphicon glyphicon-unchecked"></span></label>
                                                <label><input ng-show="scheduleModel.id == sched.id" type="checkbox" ng-model="scheduleModel.saturday">Sat </label>
                                            </div>
                                        </td>
                                        <td class="col-md-1">
                                            <a href><span ng-show="scheduleModel.id == sched.id && scheduleModel.new != true" class="glyphicon glyphicon-floppy-disk" ng-click="pc.submitEditSchedule();"></span></a>
                                            <a href><span ng-show="scheduleModel.id == sched.id && scheduleModel.new" class="glyphicon glyphicon-floppy-disk" ng-click="pc.submitAddSchedule();"></span></a>
                                            <a href><span ng-hide="scheduleModel.id == sched.id" class="glyphicon glyphicon-pencil" ng-click="pc.mapModelForSchedEdit(sched)"></span></a>
                                            - - <a href><span class="glyphicon glyphicon-trash" ng-click="pc.submitDeleteSchedule(sched.id);"></span></a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- END EDIT SCHEDULE-->
                    <!-- START HISTORY -->
                    <div ng-show="currentPage == 'history'" id="navpane">
                        <div class="tbl-header">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <thead>
                                    <th class="col-md-1">Station</th>
                                    <th class="col-md-1">History</th>
                                    <th class="col-md-3">Started</th>
                                    <th class="col-md-2">Duration</th>
                                    <th>Scheduled</th>
                                    <th>Schedule ID</th>
                                </thead>
                            </table>
                        </div>
                        <div class="tbl-content">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <tbody>
                                    <tr ng-repeat="hist in history">
                                        <td class="col-md-1">{[hist.sid]}</td>
                                        <td class="col-md-1">{[hist.id]}</td>
                                        <td class="col-md-3">{[pc.prettyTime(hist.starttime)]}</td>
                                        <td class="col-md-2">{[hist.duration / 60]} min</td>
                                        <td>{[hist.schedule_id != 0]}</td>
                                        <td>{[hist.schedule_id]}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- START HISTORY -->
                    <!-- START STATION EDIT FORM -->
                    <div id="navpane addform" ng-show="currentPage == 'editStation'">
                        <form class="form-horizontal">
                            <!-- make me an interactive svg if you're cool -->
                            <div ng-show="addMessage">{[gpio_add_model.message]}</div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="gpiobutton">GPIO:</label>
                                <div id="gpiobutton" class="dropdown col-sm-8">
                                    <button class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">{[edit_station_model.GPIO]}</button>
                                    <span class="caret"></span> <a  ng-click="show_gpio_diagram = !show_gpio_diagram">[show diagram]</a>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li ng-repeat="gpio in gpio_pins" ng-click="edit_station_model.GPIO = gpio.gpio"><a >{[gpio.gpio]} - {[gpio.notes]}</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="notes">Notes:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="notes" placeholder="{[edit_station_model.notes]}">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-8">
                                    <div class="checkbox">
                                        <label><input type="checkbox"> Enabled</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-8">
                                    <button type="submit" class="btn btn-success">Save</button>
                                </div>
                            </div>
                        </form>
                        <center>
                        <img id="gpiodiag" ng-show="show_gpio_diagram" src="static/gpio_layout.png" height="300" width="900">
                        </center>
                    </div>
                    <!-- END STATION EDIT FORM -->
                    <!-- START ADD STATION FORM -->
                    <div id="navpane addform" ng-show="currentPage == 'addStation'">
                        <form class="form-horizontal">
                            <!-- make me an interactive svg if you're cool -->
                            <div ng-show="addMessage">{[gpio_add_model.message]}</div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="gpiobutton">GPIO:</label>
                                <div id="gpiobutton" class="dropdown col-sm-8">
                                    <button ng-show="gpio_add_model.GPIO != undefined" class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">GPIO: {[gpio_add_model.GPIO]}</button>
                                    <button ng-hide="gpio_add_model.GPIO != undefined" class="btn btn-success dropdown-toggle" type="button" data-toggle="dropdown">GPIO: {[gpio_add_model.default_message]}</button>
                                    <span class="caret"></span> <a  ng-click="show_gpio_diagram = !show_gpio_diagram">[show diagram]</a>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li ng-repeat="gpio in gpio_pins" ng-click="pc.setGPIO(gpio.gpio)"><a >{[gpio.gpio]} - {[gpio.notes]}</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-sm-2" for="notes">Notes:</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control" id="notes" placeholder="Any notes regarding this station.">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-8">
                                    <div class="checkbox">
                                        <label><input type="checkbox"> Enabled</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-offset-2 col-sm-8">
                                    <button type="submit" class="btn btn-success">Save</button>
                                </div>
                            </div>
                        </form>
                        <center>
                        <img id="gpiodiag" ng-show="show_gpio_diagram" src="static/gpio_layout.png" height="300" width="900">
                        </center>
                    </div>
                    <!-- END ADD STATION FORM -->
                </section>
            </section>
            <div class="made-with-love">
                Made with <i>♥</i> by
                <a target="_blank" href="">Joe Vacovsky Jr.</a>
            </div>
            
        </div>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angularjs-slider/5.5.0/rzslider.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.14.3/ui-bootstrap-tpls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.2.0/bootstrap-slider.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.3.0/Chart.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.1/angular-material.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-chart.js/1.0.3/angular-chart.min.js"></script>
<script src="/static/app.js"></script>
<script src="/static/table.js"></script>
</html>